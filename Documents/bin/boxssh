#!/bin/sh
set -eu

die () {
    echo "$@"
    exit 1
}

command -v ip > /dev/null || die "Can't find ip."
alias ssh='ssh -o "UserKnownHostsFile /dev/null" -o "StrictHostKeyChecking no" -i "$HOME/.ssh/dojo_box_rsa" -l root -p 64222'

if [ -n "${1:-}" ]
then
    gateway="$1"
else
    gateway="$(ip neigh show | awk '$5 ~ /^38:b8:eb:5/ || $5 ~ /^b8:27:eb:/ {print $1}')"
    [ -n "$gateway" ] || die "Can't find Dojo box IP."
fi
ssh "$gateway"
